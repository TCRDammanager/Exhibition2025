<!DOCTYPE html>
<html lang="ml">
<head>
  <meta charset="UTF-8">
  <title>റിസർവോയർ ജലവിതാനം MSL</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .page-header {
      background-color: #003366;
      color: white;
      text-align: center;
      padding: 5px;
      font-size: 18px;
      font-weight: bold;
    }

    .scroll-heading {
      background-color: #0268b6;
      color: white;
      padding: 5px;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
    }

    .scroll-container {
      width: 420px;
      margin: 0 auto;
      border: 1px solid #ccc;
      background: rgba(255, 255, 255, 0.9);
      box-sizing: border-box;
      font-size: 20px;
      font-weight: bold;
      position: relative;
      overflow: hidden;
    }

    .background-table {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height : 400px;
      opacity: 0;
      z-index: 0;
      pointer-events: none;
      filter: blur(0.5px);
    }

    table {
      border-collapse: collapse;
      width: 100%;
    }

    thead th {
      background-color: #e0e0e0;
      border: 0px solid #999;
      padding: 6px;
      text-align: center;
      font-size: 14px;
    }

    td {
      border: 1px solid #999;
      padding: 5px;
      text-align: left;
      background-color: white;
    }

    .table-wrapper {
      height: 450px;
      overflow: hidden;
      position: relative;
      z-index: 1;
    }

    .scrolling-body {
      display: inline-block;
      transform: translateY(100%);
      animation: scrollUp 30s linear forwards;
    }

    @keyframes scrollUp {
      0% {
        transform: translateY(100%);
      }
      100% {
        transform: translateY(-100%);
      }
    }

    .scroll-footer {
      background-color: #8B080A;
      padding: 1px;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      color: white;
    }
  </style>
</head>
<body>

  <div class="page-header">റിസർവോയർ ജലവിതാനം MSL</div>
  <div id="heading" class="scroll-heading"></div>

  <div class="scroll-container">
    <div class="background-table">
      <table>
        <thead id="bgTableHeader"></thead>
        <tbody id="bgTableBody"></tbody>
      </table>
    </div>

    <table>
      <colgroup>
        <col style="width: 80%;">
        <col style="width: 20%;">
        <col style="width: 20%;">
      </colgroup>
      <thead id="tableHeader"></thead>
    </table>

    <div class="table-wrapper">
      <div id="scrollContent" class="scrolling-body">
        <table>
          <colgroup>
            <col style="width: 100%;">
            <col style="width: 5%;">
            <col style="width: 5%;">
          </colgroup>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div id="footer" class="scroll-footer">Date</div>

  <script>
    const groups = [
      { headerRow: 69, rowsStart: 72, rowsCount: 7 },
      { headerRow: 89, rowsStart: 92, rowsCount: 7 },
      { headerRow: 109, rowsStart: 112, rowsCount: 7 },
      { headerRow: 129, rowsStart: 132, rowsCount: 7 },
      { headerRow: 149, rowsStart: 152, rowsCount: 7 },
      { headerRow: 169, rowsStart: 172, rowsCount: 7 },
      { headerRow: 189, rowsStart: 192, rowsCount: 2 }
    ];

    let data = [];
    let currentGroup = 0;

    async function fetchData() {
      const url = "https://script.google.com/macros/s/AKfycbwAVdup8vA9azugUebxVy9YQ2BPde9LHodACwcWMYCAkklETpzQ_nIIEui9jBtAgFS3zQ/exec";
      try {
        const response = await fetch(url);
        const jsonData = await response.json();
        data = jsonData.value || [];

        const footer = document.getElementById("footer");
        const a1Value = data[0][0];
        const date = new Date(a1Value);
        footer.textContent = !isNaN(date)
          ? String(date.getDate()).padStart(2, '0') + '/' +
            String(date.getMonth() + 1).padStart(2, '0') + '/' +
            date.getFullYear()
          : a1Value || "Invalid Date";

        showGroup(currentGroup);
      } catch (error) {
        console.error("Error fetching data:", error);
        document.getElementById("footer").textContent = "Error loading data";
        document.getElementById("heading").textContent = "Header unavailable";
      }
    }

    function showGroup(index) {
      if (index >= groups.length) return;

      const heading = document.getElementById("heading");
      const tableHeader = document.getElementById("tableHeader");
      const tableBody = document.getElementById("tableBody");
      const bgTableHeader = document.getElementById("bgTableHeader");
      const bgTableBody = document.getElementById("bgTableBody");
      const scrollContent = document.getElementById("scrollContent");

      const group = groups[index];
      const headerRowIndex = group.headerRow;
      const rowsStart = group.rowsStart;
      const rowsCount = group.rowsCount;

      heading.textContent = data[headerRowIndex]?.[0] || "Header unavailable";

      const headerRow = data[headerRowIndex + 1] || [];
      tableHeader.innerHTML = "";
      bgTableHeader.innerHTML = "";

      const trHeader = document.createElement("tr");
      const trHeaderBg = document.createElement("tr");

      headerRow.forEach(cell => {
        const th = document.createElement("th");
        th.textContent = cell || '';
        trHeader.appendChild(th);

        const thBg = document.createElement("th");
        thBg.textContent = cell || '';
        trHeaderBg.appendChild(thBg);
      });

      tableHeader.appendChild(trHeader);
      bgTableHeader.appendChild(trHeaderBg);

      const rows = data.slice(rowsStart, rowsStart + rowsCount);
      tableBody.innerHTML = "";
      bgTableBody.innerHTML = "";

      rows.forEach((row, i) => {
        const tr = document.createElement("tr");
        const trBg = document.createElement("tr");
        const isLastRow = i === rows.length - 1;

        row.forEach((cell, colIndex) => {
          const td = document.createElement("td");
          const tdBg = document.createElement("td");

          let value = cell;

          if (colIndex === 1 && !isNaN(parseFloat(cell))) {
            value = parseFloat(cell).toFixed(3);
            td.style.textAlign = "right";
            tdBg.style.textAlign = "right";
          }

          if ((i === 6) && colIndex === 1 && !isNaN(parseFloat(cell))) {
            value = parseFloat(cell).toFixed(2);
          }

          td.textContent = value || '';
          tdBg.textContent = value || '';

          if (i === 3) {
            td.style.color = "red";
            td.style.fontWeight = "bold";
            tdBg.style.color = "red";
            tdBg.style.fontWeight = "bold";
          } else if (i === 4) {
            td.style.color = "blue";
            td.style.fontWeight = "bold";
            tdBg.style.color = "blue";
            tdBg.style.fontWeight = "bold";
          }

          if (i === 6) {
            td.style.fontSize = "24px";
            tdBg.style.fontSize = "24px";
            td.style.color = "green";
            td.style.fontWeight = "bold";
            tdBg.style.color = "green";
            tdBg.style.fontWeight = "bold";

          }

          tr.appendChild(td);
          trBg.appendChild(tdBg);
        });

        tableBody.appendChild(tr);
        bgTableBody.appendChild(trBg);
      });

      scrollContent.style.animation = "none";
      void scrollContent.offsetWidth;
      const duration = rowsCount * 3;
      scrollContent.style.animation = `scrollUp ${duration}s linear forwards`;

      setTimeout(() => {
        currentGroup++;
        showGroup(currentGroup);
      }, duration * 1000 + 500);
    }

    fetchData();
  </script>

</body>
</html>
